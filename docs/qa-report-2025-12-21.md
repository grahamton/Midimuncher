# QA Report: 2025-12-21

## Summary

Performed a static analysis of `packages/core` and `apps/desktop` due to terminal unavailability.

## Fixes

- **`packages/core/src/index.ts`**: Removed duplicate export of `./sequencers/runner`.

## Findings

### 1. Architectural Violation: `App.tsx` (Critical)

`apps/desktop/src/app/App.tsx` is a "God Object" containing **2737 lines**.

- **Issue**: It violates the agent flow rule: _"Keeps App.tsx as the router... wires Stage/Surface/Mapping pages... keeps the scheduler/persistence code outside React"_.
- **Content**: It currently manages references to:
  - Session recording
  - MIDI Port management
  - Device/Route management
  - Snapshot logic
  - Sequencer stepping
  - Diagnostics
- **Recommendation**: This logic must be extracted into `packages/core` (for pure logic) or custom hooks/contexts (for react state) to allow the **UI Agent** and **Core Agent** to work independently.

### 2. Empty Directory

- `packages/core/src/engine` appears to be empty.
  - **Recommendation**: Delete if unused, or populate if it was intended for the logic currently trapping inside `App.tsx`.

### 3. Sequencer Logic Note

- `packages/core/src/sequencers/runner.ts`: `collectEvents` prioritizes `sequencerId` over `events` in a step. If both exist, manual events are ignored. Verify if this is intended behavior.

## Next Steps

1. **Refactor `App.tsx`**: Break down the monolithic state into:
   - `useMidiDeviceManager`
   - `useSessionRecorder`
   - `useSnapshotManager`
   - `useSequencerEngine`
2. **Move Logic to Core**: Ensure `packages/core` handles the heavy lifting, exposing simple APIs to the UI.
